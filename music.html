<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>unSAME Soundtracks Player</title>
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
  
  <!-- Open Graph Info -->
  <meta property="og:title" content="unSAME Soundtracks Player" />
  <meta property="og:description" content="Listen to the soundtracks of unSAME games composed by talented artists." />
  <meta property="og:image" content="images/Logo White (Small).png" />
  <meta property="og:url" content="https://unsame.fun/music" />

  <!-- Twitter Card Info -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="unSAME Soundtracks Player" />
  <meta name="twitter:description" content="Listen to the soundtracks of unSAME games composed by talented artists." />
  <meta name="twitter:image" content="images/Logo White (Small).png" />
  <meta name="twitter:url" content="https://unsame.fun/music" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Montserrat Font -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap" rel="stylesheet">
  
  <!-- React and ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    /* Custom Scrollbar Style */
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 10px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background-color: rgba(255, 255, 255, 0.3);
    }
    
    /* Set default font */
    body {
      font-family: 'Montserrat', sans-serif;
      font-weight: 500;
      background-color: #000;
      overflow: hidden;
    }

    /* Audio Spectrum Animation */
    @keyframes spectrum1 {
      0%, 100% { height: 16px; }
      50% { height: 24px; }
    }
    
    @keyframes spectrum2 {
      0%, 100% { height: 24px; }
      50% { height: 16px; }
    }
    
    @keyframes spectrum3 {
      0%, 100% { height: 20px; }
      50% { height: 28px; }
    }
    
    .spectrum-bar1 {
      animation: spectrum1 0.8s ease-in-out infinite;
    }
    
    .spectrum-bar2 {
      animation: spectrum2 0.85s ease-in-out infinite;
    }
    
    .spectrum-bar3 {
      animation: spectrum3 0.75s ease-in-out infinite;
    }

    /* Loading Throbber Animation */
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }

    .loading-throbber {
      animation: rotate 1.5s linear infinite;
    }

    .loading-pulse {
      animation: pulse 1.5s ease-in-out infinite;
    }

    /* Input Range Styling */
    input[type="range"] {
      -webkit-appearance: none;
      height: 6px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 5px;
      background-image: linear-gradient(rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.8));
      background-size: 0% 100%;
      background-repeat: no-repeat;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: white;
      cursor: pointer;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
    }

    input[type="range"]::-moz-range-thumb {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: white;
      cursor: pointer;
      border: none;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
    }

    /* Responsive adjustments */
    @media (max-width: 640px) {
      .mobile-scale {
        transform: scale(1.2);
        margin: 0.75rem 0;
      }
      
      .mobile-control-scale {
        transform: scale(1.3);
      }
    }

    /* Bouncy Button Animations */
    @keyframes bounce {
      0%, 100% { transform: scale(1); }
      60% { transform: scale(0.9); }
      80% { transform: scale(1.1); }
    }

    @keyframes wiggle {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-7deg); }
      75% { transform: rotate(7deg); }
    }

    .btn-bounce {
      transition: all 0.2s;
    }

    .btn-bounce:active {
      animation: bounce 0.4s cubic-bezier(0.36, 0, 0.66, -0.56) both;
    }

    .btn-bounce:hover {
      transform: scale(1.05);
    }

    .playlist-btn {
      transition: all 0.3s;
    }

    .playlist-btn:hover {
      animation: wiggle 0.6s cubic-bezier(0.36, 0, 0.66, -0.56) both;
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React; // Added useCallback
    
    // Common arrays for games and composers
    const games = [
      { 
        id: "gulltastrophe", 
        title: "Gulltastrophe", 
        url: "https://unsame.fun/seagull",
        coverArt: "https://unsame.fun/images/gulltastrophe.png",
        hasVideo: true,
        videoUrl: "https://unsame.fun/videos/previews/seagull.mp4"
      },
      { 
        id: "plug-it-in", 
        title: "PLUG IT IN", 
        url: "https://unsame.itch.io/plug-it-in",
        coverArt: "https://unsame.fun/images/plug.png",
        hasVideo: true,
        videoUrl: "https://unsame.fun/videos/previews/plugitin.mp4"
      },
      { 
        id: "runway", 
        title: "Runway", 
        url: "https://unsame.itch.io/runway",
        coverArt: "https://unsame.fun/images/Runway.png",
        hasVideo: true,
        videoUrl: "https://unsame.fun/videos/previews/runway.mp4"
      },
      { 
        id: "love-stickin", 
        title: "Love Stickin'", 
        url: "https://samfeng.itch.io/love-stickin",
        coverArt: "https://unsame.fun/images/ItchCoverLove.png",
        hasVideo: false
      },
      { 
        id: "portarumaku", 
        title: "Portarumaku", 
        url: "https://weisa.itch.io/portarumaku",
        coverArt: "https://unsame.fun/images/portarumaku.png",
        hasVideo: false
      },
      { 
        id: "sushi-unroll", 
        title: "SUSHI unROLL", 
        url: "https://unsame.itch.io/sushi-unroll",
        coverArt: "https://unsame.fun/images/SUSHI unROLL.png",
        hasVideo: false
      }
    ];

    const composers = [
      { id: "shawntrrttll", name: "Shawntrrttll", url: "https://soundcloud.com/franco-toledo" },
      { id: "arx", name: "Arx", url: "https://soundcloud.com/arxgame" },
      { id: "shape-shop", name: "ShapeShop", url: "https://soundcloud.com/shap3shop" }
    ];

    // Song data referencing games and composers by string ID
    const songData = [
      // Songs from "PLUG IT IN"
      {
        id: 1,
        title: "Fix A Problem",
        gameId: "plug-it-in",
        composerId: "arx",
        audioUrl: "https://unsame.fun/audios/music/Fix A Problem.mp3"
      },
      {
        id: 2,
        title: "Blue Moon",
        gameId: "plug-it-in",
        composerId: "arx",
        audioUrl: "https://unsame.fun/audios/music/bluemoon.ogg"
      },
      {
        id: 3,
        title: "Cables Mellow",
        gameId: "plug-it-in",
        composerId: "arx",
        audioUrl: "https://unsame.fun/audios/music/cables mellow.ogg"
      },
      {
        id: 4,
        title: "Cha Cha",
        gameId: "plug-it-in",
        composerId: "arx",
        audioUrl: "https://unsame.fun/audios/music/chacha.ogg"
      },
      {
        id: 5,
        title: "I Forgot My Math Quiz",
        gameId: "plug-it-in",
        composerId: "arx",
        audioUrl: "https://unsame.fun/audios/music/mathquiz.ogg"
      },

      // Songs from "Gulltastrophe"
      {
        id: 6,
        title: "Menu",
        gameId: "gulltastrophe",
        composerId: "shape-shop",
        audioUrl: "https://unsame.fun/audios/music/Seagull Menu.mp3"
      },
      {
        id: 7,
        title: "Time for Chaos",
        gameId: "gulltastrophe",
        composerId: "shawntrrttll",
        audioUrl: "https://unsame.fun/audios/music/Time for Chaos.mp3"
      },
      {
        id: 8,
        title: "Home",
        gameId: "gulltastrophe",
        composerId: "shawntrrttll",
        audioUrl: "https://unsame.fun/audios/music/Seagull Hub.mp3"
      },

      // Songs from "Runway"
      {
        id: 9,
        title: "BAMF -Instrumental-",
        gameId: "runway",
        composerId: "arx",
        audioUrl: "https://unsame.fun/audios/music/BAMF -instrumental-.mp3"
      },
      {
        id: 10,
        title: "Billed By A Box -Game Edit-",
        gameId: "runway",
        composerId: "arx",
        audioUrl: "https://unsame.fun/audios/music/BilledByABox_Gameedit.mp3"
      },
      {
        id: 11,
        title: "Game Over -Game Edit-",
        gameId: "runway",
        composerId: "arx",
        audioUrl: "https://unsame.fun/audios/music/GameOver_Game Edit.mp3"
      },
      {
        id: 12,
        title: "Signal -Game Edit-",
        gameId: "runway",
        composerId: "arx",
        audioUrl: "https://unsame.fun/audios/music/Signal_Game Edit.mp3"
      },

      // Songs from "Love Stickin'"
      {
        id: 13,
        title: "Love Stickin'",
        gameId: "love-stickin",
        composerId: "shawntrrttll",
        audioUrl: "https://unsame.fun/audios/music/Love Stickin.mp3"
      },

      // Songs from "Portarumaku"
      {
        id: 14,
        title: "Round and Round",
        gameId: "portarumaku",
        composerId: "arx",
        audioUrl: "https://unsame.fun/audios/music/round and round.mp3"
      },
      {
        id: 15,
        title: "Round and Round -Pixel Mix-",
        gameId: "portarumaku",
        composerId: "arx",
        audioUrl: "https://unsame.fun/audios/music/round and round(Pixel Mix).mp3"
      },

      // Songs from "SUSHI unROLL"
      {
        id: 16,
        title: "Sushi Love",
        gameId: "sushi-unroll",
        composerId: "arx",
        audioUrl: "https://unsame.fun/audios/music/SushiLove.mp3"
      },
      {
        id: 17,
        title: "Sushi Love -Nightcore Remix-",
        gameId: "sushi-unroll",
        composerId: "arx",
        audioUrl: "https://unsame.fun/audios/music/SushiLoveNightcore.mp3"
      }
    ];

    // Define icons/assets for each game
    const gameIcons = {
      "gulltastrophe": [
        { src: "https://unsame.fun/images/playericons/seagull.png", width: 80, rotation: [-30, 30] },
        { src: "https://unsame.fun/images/playericons/seagullheart.png", width: 40, rotation: [-30, 30] }
      ],
      "plug-it-in": [
        { src: "https://unsame.fun/images/playericons/mini_all.png", width: 40, rotation: [-30, 30] },
        { src: "https://unsame.fun/images/playericons/mini_one.png", width: 40, rotation: [-30, 30] },
        { src: "https://unsame.fun/images/playericons/mini_two.png", width: 40, rotation: [-30, 30] }
      ],
      "love-stickin": [
        { src: "https://unsame.fun/images/playericons/stickinheart.png", width: 40, rotation: [-30, 30] },
      ],
      "portarumaku": [
        { src: "https://unsame.fun/images/playericons/portaruwitch.png", width: 60, rotation: [-30, 30] },
      ],
      "sushi-unroll": [
        { src: "https://unsame.fun/images/playericons/salmon.png", width: 60, rotation: [-30, 30] },
        { src: "https://unsame.fun/images/playericons/shrimp.png", width: 60, rotation: [-30, 30] },
        { src: "https://unsame.fun/images/playericons/zucchini.png", width: 60, rotation: [-30, 30] },
        { src: "https://unsame.fun/images/playericons/sushi_roll_piece.png", width: 40, rotation: [-30, 30] }
      ]
    };

    // Beat detection component
    const BeatDetector = ({ audioRef, gameId, onBeat }) => {
      const lastBeatTime = useRef(0);
      const lastVolume = useRef(0);
      const animationFrameRef = useRef(null);
    
      // Simple beat detection based on volume changes
      useEffect(() => {
        let isActive = true;
    
        const detectBeat = () => {
          if (!isActive || !audioRef.current) return;
    
          try {
            // Get current volume level from audio element
            const currentVolume = audioRef.current.volume * audioRef.current.playbackRate;
            const now = Date.now();
            
            // Detect sudden volume increases as beats
            if (currentVolume > lastVolume.current * 1.1 && now - lastBeatTime.current > 300) {
              lastBeatTime.current = now;
              onBeat();
            }
            
            lastVolume.current = currentVolume;
            animationFrameRef.current = requestAnimationFrame(detectBeat);
          } catch (error) {
            console.warn("Beat detection error:", error);
          }
        };
    
        detectBeat();
    
        return () => {
          isActive = false;
          if (animationFrameRef.current) {
            cancelAnimationFrame(animationFrameRef.current);
          }
        };
      }, [onBeat]);
    
      // Trigger beats on regular intervals as fallback
      useEffect(() => {
        const interval = setInterval(() => {
          const now = Date.now();
          if (now - lastBeatTime.current > 500) { // Fallback beat every 500ms
            lastBeatTime.current = now;
            onBeat();
          }
        }, 500);
    
        return () => clearInterval(interval);
      }, [onBeat]);
    
      return null;
    };

    // Floating icon component
    const FloatingIcon = ({ icon, startPosition, onAnimationEnd }) => {
      const [position, setPosition] = useState(startPosition);
      const [rotation, setRotation] = useState(0);
      const [isVisible, setIsVisible] = useState(true);
      
      useEffect(() => {
        // Random rotation between min and max values
        const randomRotation = icon.rotation[0] + Math.random() * (icon.rotation[1] - icon.rotation[0]);
        setRotation(randomRotation);
        
        // Random horizontal position adjustment (slight drift)
        const horizontalDrift = -10 + Math.random() * 20; // -10px to +10px
        
        // Animation timing
        const animationDuration = 2000 + Math.random() * 1000; // 2-3 seconds
        
        // Start animation
        let animationTimer;
        let startTime = Date.now();
        
        const animate = () => {
          const elapsed = Date.now() - startTime;
          const progress = elapsed / animationDuration;
          
          if (progress < 1) {
            // Parabolic trajectory with slight horizontal drift
            const verticalProgress = Math.sin(progress * Math.PI); // 0 -> 1 -> 0 curve
            const newY = startPosition.y - (verticalProgress * 200); // Up to 200px above starting point
            const newX = startPosition.x + (progress * horizontalDrift);
            
            setPosition({ x: newX, y: newY });
            animationTimer = requestAnimationFrame(animate);
          } else {
            setIsVisible(false);
            setTimeout(() => onAnimationEnd(), 100); // Clean up after animation
          }
        };
        
        animationTimer = requestAnimationFrame(animate);
        
        return () => {
          if (animationTimer) {
            cancelAnimationFrame(animationTimer);
          }
        };
      }, []);
      
      if (!isVisible) return null;
      
      return (
        <div 
          className="absolute z-10 pointer-events-none"
          style={{
            left: `${position.x}px`,
            top: `${position.y}px`,
            transform: `rotate(${rotation}deg)`,
            transition: 'transform 0.3s ease'
          }}
        >
          <img 
            src={icon.src} 
            alt="Game icon" 
            width={icon.width}
            className="drop-shadow-lg opacity-90"
          />
        </div>
      );
    };

    // Helper function to get complete song information
    const getCompleteSongData = () => {
      return songData.map(song => ({
        ...song,
        game: games.find(game => game.id === song.gameId),
        composer: composers.find(composer => composer.id === song.composerId)
      }));
    };

    // Loading Throbber Component
    const LoadingThrobber = ({ size = 20 }) => (
      <div className="loading-throbber" style={{ width: size, height: size }}>
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle 
            cx="12" 
            cy="12" 
            r="10" 
            stroke="white" 
            strokeOpacity="0.3" 
            strokeWidth="2" 
          />
          <path 
            d="M12 2C6.47715 2 2 6.47715 2 12" 
            stroke="white" 
            strokeWidth="2" 
            strokeLinecap="round" 
          />
        </svg>
      </div>
    );

    // Mobile detection helper
    const useMobileDetect = () => {
      const [isMobile, setIsMobile] = useState(false);
      
      useEffect(() => {
        const checkMobile = () => {
          setIsMobile(window.innerWidth < 640);
        };
        
        // Initial check
        checkMobile();
        
        // Add resize listener
        window.addEventListener('resize', checkMobile);
        
        // Cleanup
        return () => window.removeEventListener('resize', checkMobile);
      }, []);
      
      return isMobile;
    };

    const UnSAMEMusicPlayer = () => {
      const completeData = getCompleteSongData();
      const [currentTrack, setCurrentTrack] = useState(completeData[0]);
      const [isPlaying, setIsPlaying] = useState(false);
      const [progress, setProgress] = useState(0);
      const [duration, setDuration] = useState(0);
      const [volume, setVolume] = useState(0.7);
      const [showPlaylist, setShowPlaylist] = useState(false);
      const [transitioning, setTransitioning] = useState(false);
      const [isLoading, setIsLoading] = useState(true);
      const [isChanging, setIsChanging] = useState(false);
      
      const audioRef = useRef(null);
      const intervalRef = useRef(null);
      const playlistRef = useRef(null);
      const progressBarRef = useRef(null);
      
      const isMobile = useMobileDetect();

      // 1. Add this after your useState declarations to get the initial song from URL
      useEffect(() => {
        const songIdFromURL = getSongIdFromURL();
        if (songIdFromURL) {
          const songFromURL = completeData.find(song => song.id.toString() === songIdFromURL);
          if (songFromURL) {
            setCurrentTrack(songFromURL);
            // Auto-play when someone arrives via a shared link (optional)
            setTimeout(() => {
              if (audioRef.current) {
                const playPromise = audioRef.current.play();
                if (playPromise !== undefined) {
                  playPromise
                    .then(() => {
                      startTimer();
                      setIsPlaying(true);
                    })
                    .catch(error => {
                      console.error("Error auto-playing audio:", error);
                    });
                }
              }
            }, 1000);
          }
        }
      }, []);
      
      // Update progress bar fill based on current progress
      useEffect(() => {
        if (progressBarRef.current && duration > 0) {
          const percent = (progress / duration) * 100;
          progressBarRef.current.style.backgroundSize = `${percent}% 100%`;
        }
      }, [progress, duration]);

      useEffect(() => {
        // Clear any existing interval when component mounts
        return () => {
          clearInterval(intervalRef.current);
        };
      }, []);

      useEffect(() => {
        if (audioRef.current) {
          audioRef.current.volume = volume;
        }
      }, [volume]);

      // Add event listener to close playlist when clicking outside
      useEffect(() => {
        const handleClickOutside = (event) => {
          if (showPlaylist && playlistRef.current && !playlistRef.current.contains(event.target)) {
            setShowPlaylist(false);
          }
        };

        document.addEventListener('mousedown', handleClickOutside);
        return () => {
          document.removeEventListener('mousedown', handleClickOutside);
        };
      }, [showPlaylist]);

      const handleTrackChange = (track) => {
        if (isChanging) return; // Prevent changing while already changing
        
        setIsChanging(true);
        setTransitioning(true);
        setIsLoading(true);
        setProgress(0);
        setDuration(0);
        
        // Update URL with the song ID
        updateURLWithSongId(track.id);
        
        // Delay changing track to allow for transition animation
        setTimeout(() => {
          setCurrentTrack(track);
          if (progressBarRef.current) {
            progressBarRef.current.style.backgroundSize = "0% 100%";
          }
          
          setIsPlaying(true);
          
          // Need to manually call play after setting new src
          setTimeout(() => {
            if (!audioRef.current) return;
            
            const playPromise = audioRef.current.play();
            if (playPromise !== undefined) {
              playPromise
                .then(() => {
                  startTimer();
                  setIsChanging(false);
                })
                .catch(error => {
                  console.error("Error playing audio:", error);
                  setIsPlaying(false);
                  setIsChanging(false);
                });
            }
          }, 100);
          
          setTransitioning(false);
        }, 500);
      };

      const playNextTrack = useCallback(() => {
        const currentIndex = completeData.findIndex(track => track.id === currentTrack.id);
        const nextIndex = (currentIndex + 1) % completeData.length;
        handleTrackChange(completeData[nextIndex]);
      }, [currentTrack.id, completeData]); // Add dependencies

      const onAudioEnded = useCallback(() => {
        clearInterval(intervalRef.current);
        playNextTrack();
      }, [playNextTrack]); // Add playNextTrack as dependency

      const startTimer = useCallback(() => {
        clearInterval(intervalRef.current);
        
        intervalRef.current = setInterval(() => {
          if (audioRef.current?.ended) {
            onAudioEnded();
          } else {
            setProgress(audioRef.current?.currentTime || 0);
          }
        }, 100);
      }, [onAudioEnded]);

      const onLoadedMetadata = () => {
        setDuration(audioRef.current.duration);
        setIsLoading(false);
      };

      const togglePlay = () => {
        if (!isPlaying) {
          const playPromise = audioRef.current.play();
          
          if (playPromise !== undefined) {
            playPromise
              .then(() => {
                startTimer();
                setIsPlaying(true);
              })
              .catch(error => {
                console.error("Error playing audio:", error);
              });
          }
        } else {
          audioRef.current.pause();
          clearInterval(intervalRef.current);
          setIsPlaying(false);
        }
      };

      const playPrevTrack = () => {
        const currentIndex = completeData.findIndex(track => track.id === currentTrack.id);
        const prevIndex = (currentIndex - 1 + completeData.length) % completeData.length;
        handleTrackChange(completeData[prevIndex]);
      };

      const formatTime = (time) => {
        if (isNaN(time)) return "0:00";
        
        const minutes = Math.floor(time / 60);
        const seconds = Math.floor(time % 60).toString().padStart(2, '0');
        return `${minutes}:${seconds}`;
      };

      const handleProgressChange = (e) => {
        const newTime = parseFloat(e.target.value);
        setProgress(newTime);
        audioRef.current.currentTime = newTime;
      };

      // State for floating icons
      const [floatingIcons, setFloatingIcons] = useState([]);
      const containerRef = useRef(null);

      // Handle beat detection
      const handleBeat = useCallback(() => {
        if (!containerRef.current || !gameIcons[currentTrack.gameId]) return;
        
        // Get container dimensions
        const containerRect = containerRef.current.getBoundingClientRect();
        
        // Choose a random icon from the game's set
        const gameIconSet = gameIcons[currentTrack.gameId];
        if (!gameIconSet || gameIconSet.length === 0) return;
        
        const randomIcon = gameIconSet[Math.floor(Math.random() * gameIconSet.length)];
        
        // Random starting position (at the bottom of the container)
        const startX = containerRect.width * 0.25 + Math.random() * (containerRect.width * 0.5);
        const startY = containerRect.height + 20; // Start below the visible area
        
        // Create new icon with unique ID
        const newIcon = {
          id: Date.now(),
          icon: randomIcon,
          position: { x: startX, y: startY }
        };
        
        // Add to state
        setFloatingIcons(prev => [...prev, newIcon]);
      }, [currentTrack.gameId]);

      // Remove icon after animation
      const removeIcon = useCallback((id) => {
        setFloatingIcons(prev => prev.filter(icon => icon.id !== id));
      }, []);


      return (
        <div ref={containerRef} className="flex flex-col items-center justify-center h-screen w-full overflow-hidden relative">
          {/* Background Media (Image/Video) with blur effect */}
          <div className="absolute inset-0 z-0">
            <div className="absolute inset-0 bg-black bg-opacity-60 backdrop-blur-md z-10"></div>
            <div className={`w-full h-full transition-opacity duration-1000 ${transitioning ? 'opacity-0' : 'opacity-100'}`}>
              {currentTrack.game.hasVideo ? (
                <video 
                  src={currentTrack.game.videoUrl} 
                  poster={currentTrack.game.coverArt}
                  muted
                  loop
                  autoPlay
                  className="w-full h-full object-cover"
                />
              ) : (
                <img 
                  src={currentTrack.game.coverArt} 
                  alt={`${currentTrack.game.title} background`} 
                  className="w-full h-full object-cover"
                />
              )}
            </div>
          </div>
          
          {/* Company Logo */}
          <div className={`z-10 mb-4 md:mb-8 ${isMobile ? 'mt-4' : ''}`}>
            <h1 className="text-3xl md:text-4xl font-bold tracking-wider text-white text-center">unSAME</h1>
            <p className="text-gray-300 text-sm mt-1 text-center">GAME SOUNDTRACKS</p>
          </div>
          
          {/* Main Player Section */}
          <div className={`z-10 w-full max-w-3xl px-4 md:px-6 flex flex-col items-center ${isMobile ? 'scale-110 py-4' : ''}`}>
            {/* Track Info */}
            <div className="mb-6 md:mb-12 text-center w-full">
              <div className={`bg-white bg-opacity-10 backdrop-blur-md px-6 md:px-12 py-4 md:py-8 rounded-xl transition-all duration-500 w-full max-w-2xl mx-auto ${transitioning ? 'opacity-0 transform translate-y-4' : 'opacity-100 transform translate-y-0'}`}>
                <h2 className="text-xl md:text-2xl font-medium text-white mb-2 md:mb-3">
                  {currentTrack.title}
                </h2>
                <a 
                  href={currentTrack.game.url} 
                  className="text-gray-300 block mb-1 md:mb-2 hover:text-white transition-colors hover:underline"
                >
                  {currentTrack.game.title}
                </a>
                <a 
                  href={currentTrack.composer.url}
                  className="text-gray-400 text-sm hover:text-white transition-colors inline-flex"
                >
                  <span className="mr-1">Composed by</span>
                  <span className="hover:underline">{currentTrack.composer.name}</span>
                </a>
              </div>
            </div>
            
            {/* Audio Element */}
            <audio 
              ref={audioRef}
              src={currentTrack.audioUrl}
              preload="auto"
              onLoadedMetadata={onLoadedMetadata}
              onEnded={onAudioEnded}
              onLoadStart={() => setIsLoading(true)}
              onPlay={() => {
                setIsLoading(false);
                startTimer(); // Add this to ensure timer starts on play
              }}
              onError={() => {
                setIsLoading(false);
                setIsChanging(false);
              }}
            />
            
            {/* Progress Bar */}
            <div className="mb-4 md:mb-6 flex items-center space-x-2 w-full" style={{ maxWidth: isMobile ? '300px' : '500px' }}>
              <div className="w-12 text-right flex items-center justify-end h-6">
                {isLoading ? (
                  <div className="loading-pulse">
                    <LoadingThrobber size={16} />
                  </div>
                ) : (
                  <span className="text-sm text-gray-300">{formatTime(progress)}</span>
                )}
              </div>
              <input
                ref={progressBarRef}
                type="range"
                min="0"
                max={duration || 0}
                value={progress}
                onChange={handleProgressChange}
                disabled={isLoading}
                className="flex-1 rounded-full appearance-none cursor-pointer"
              />
              <div className="w-12 flex items-center h-6">
                {isLoading ? (
                  <div className="loading-pulse">
                    <LoadingThrobber size={16} />
                  </div>
                ) : (
                  <span className="text-sm text-gray-300">{formatTime(duration)}</span>
                )}
              </div>
            </div>
            
            {/* Controls */}
            <div className={`flex justify-center items-center space-x-4 md:space-x-6 mb-4 md:mb-8 ${isMobile ? 'mobile-control-scale' : ''}`}>
              <button 
                onClick={playPrevTrack}
                className="btn-bounce text-white p-3 md:p-4 rounded-full bg-white bg-opacity-20 backdrop-blur-md hover:bg-opacity-30 transition-colors w-10 h-10 md:w-12 md:h-12 flex items-center justify-center"
              >
                {/* Previous Track Icon */}
                <svg xmlns="http://www.w3.org/2000/svg" width={isMobile ? "18" : "20"} height={isMobile ? "18" : "20"} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                  <polygon points="19 20 9 12 19 4 19 20"></polygon>
                  <line x1="5" y1="19" x2="5" y2="5"></line>
                </svg>
              </button>
              
              <button 
                onClick={togglePlay}
                className="btn-bounce text-white p-4 rounded-full bg-white bg-opacity-20 backdrop-blur-md hover:bg-opacity-30 transition-colors w-14 h-14 md:w-16 md:h-16 flex items-center justify-center"
                disabled={isLoading}
              >
                {isLoading ? (
                  <LoadingThrobber size={isMobile ? 20 : 24} />
                ) : isPlaying ? (
                  <svg xmlns="http://www.w3.org/2000/svg" width={isMobile ? "22" : "24"} height={isMobile ? "22" : "24"} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <rect x="6" y="4" width="4" height="16"></rect>
                    <rect x="14" y="4" width="4" height="16"></rect>
                  </svg>
                ) : (
                  <svg xmlns="http://www.w3.org/2000/svg" width={isMobile ? "22" : "24"} height={isMobile ? "22" : "24"} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                  </svg>
                )}
              </button>
              
              <button 
                onClick={playNextTrack}
                className="btn-bounce text-white p-3 md:p-4 rounded-full bg-white bg-opacity-20 backdrop-blur-md hover:bg-opacity-30 transition-colors w-10 h-10 md:w-12 md:h-12 flex items-center justify-center"
              >
                {/* Next Track Icon */}
                <svg xmlns="http://www.w3.org/2000/svg" width={isMobile ? "18" : "20"} height={isMobile ? "18" : "20"} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                  <polygon points="5 4 15 12 5 20 5 4"></polygon>
                  <line x1="19" y1="5" x2="19" y2="19"></line>
                </svg>
              </button>
            </div>
            
            {/* Volume Control */}
            <div className="flex items-center justify-center space-x-2 mb-4 md:mb-8">
              <button 
                onClick={() => {
                  const newVolume = volume > 0 ? 0 : 0.7;
                  setVolume(newVolume);
                }}
                className="btn-bounce text-white p-2 rounded-full bg-white bg-opacity-20 backdrop-blur-md hover:bg-opacity-30 transition-colors w-8 h-8 flex items-center justify-center"
              >
                {volume > 0 ? (
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                    <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                  </svg>
                ) : (
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                    <line x1="23" y1="9" x2="17" y2="15"></line>
                    <line x1="17" y1="9" x2="23" y2="15"></line>
                  </svg>
                )}
              </button>
              <input
                type="range"
                min="0"
                max="1"
                step="0.01"
                value={volume}
                onChange={(e) => setVolume(parseFloat(e.target.value))}
                className="w-24 md:w-32 h-1 bg-white bg-opacity-20 rounded-full appearance-none cursor-pointer"
              />
            </div>
          </div>
          
          {/* Playlist Toggle - Centered */}
          <button 
            onClick={() => setShowPlaylist(!showPlaylist)}
            className={`playlist-btn z-10 px-4 py-2 border border-white border-opacity-20 rounded-full
                    bg-white bg-opacity-10 backdrop-blur-md hover:bg-opacity-20 transition-colors text-white mx-auto ${isMobile ? 'text-base' : ''}`}
          >
            {showPlaylist ? "Hide Playlist" : "Show Playlist"}
          </button>
          
          {/* Playlist */}
          <div 
            ref={playlistRef}
            className={`fixed bottom-0 left-0 right-0 bg-black bg-opacity-70 backdrop-blur-lg z-20 transition-transform duration-300 ease-in-out ${showPlaylist ? 'translate-y-0' : 'translate-y-full'}`}
            style={{maxHeight: '60vh'}}
          >
            <div className="w-full max-w-3xl mx-auto p-4 md:p-6">
              <div className="flex justify-between items-center mb-4">
                <h3 className="text-lg md:text-xl font-medium text-white">Game Soundtracks</h3>
                <button 
                  onClick={() => setShowPlaylist(false)}
                  className="btn-bounce text-white p-2 rounded-full bg-white bg-opacity-10 hover:bg-opacity-20 transition-colors"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>
              
              <div className="overflow-y-auto custom-scrollbar" style={{maxHeight: 'calc(60vh - 80px)'}}>
                <ul>
                  {completeData.map(track => (
                    <li 
                      key={track.id}
                      className={`flex items-center p-3 rounded-lg mb-2 cursor-pointer hover:bg-white hover:bg-opacity-10 transition-colors
                                ${currentTrack.id === track.id ? 'bg-white bg-opacity-10' : ''}`}
                      onClick={() => handleTrackChange(track)}
                    >
                      <img 
                        src={track.game.coverArt} 
                        alt={track.title} 
                        className="w-12 h-12 object-cover rounded mr-4"
                      />
                      <div>
                        <h4 className="font-medium text-white">{track.title}</h4>
                        <div className="flex text-sm space-x-2">
                          <a 
                            href={track.game.url}
                            onClick={(e) => e.stopPropagation()}
                            className="text-gray-400 hover:text-white transition-colors hover:underline"
                          >
                            {track.game.title}
                          </a>
                          <span className="text-gray-600">•</span>
                          <a 
                            href={track.composer.url}
                            onClick={(e) => e.stopPropagation()}
                            className="text-gray-400 hover:text-white transition-colors hover:underline"
                          >
                            {track.composer.name}
                          </a>
                        </div>
                      </div>
                      {currentTrack.id === track.id && (
                        <div className="ml-auto flex items-center h-12">
                          {isLoading ? (
                            <LoadingThrobber size={16} />
                          ) : isPlaying ? (
                            <div className="flex space-x-1">
                              <div className="w-1 bg-white spectrum-bar1 transform origin-bottom"></div>
                              <div className="w-1 bg-white spectrum-bar2 transform origin-bottom"></div>
                              <div className="w-1 bg-white spectrum-bar3 transform origin-bottom"></div>
                            </div>
                          ) : (
                            <div className="w-6 h-6 flex items-center justify-center">
                              <div className="w-2 h-2 rounded-full bg-white"></div>
                            </div>
                          )}
                        </div>
                      )}
                    </li>
                  ))}
                </ul>
              </div>
            </div>
          </div>

          {/* Beat Detector */}
          {isPlaying && !isLoading && (
            <BeatDetector
              audioRef={audioRef}
              gameId={currentTrack.gameId}
              onBeat={handleBeat}
            />
          )}
          
          {/* Floating Icons */}
          {floatingIcons.map(item => (
            <FloatingIcon
              key={item.id}
              icon={item.icon}
              startPosition={item.position}
              onAnimationEnd={() => removeIcon(item.id)}
            />
          ))}
        </div>
      );
    };

    // Function to update URL with the current song ID
    const updateURLWithSongId = (songId) => {
      const url = new URL(window.location);
      url.hash = `song=${songId}`;
      window.history.replaceState({}, '', url);
    };

    // Function to get song ID from URL hash
    const getSongIdFromURL = () => {
      const hash = window.location.hash;
      if (hash && hash.includes('song=')) {
        return hash.split('song=')[1];
      }
      return null;
    };

    // Inside the UnSAMEMusicPlayer component, make these modifications:

    // Render the app
    const container = document.getElementById('root');
    const root = ReactDOM.createRoot(container);
    root.render(<UnSAMEMusicPlayer />);
  </script>
</body>
</html>